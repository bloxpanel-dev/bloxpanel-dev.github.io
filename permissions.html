<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BloxPanel Permissions</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: white;
      margin: 0;
      font-family: sans-serif;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: 250px;
      background-color: #1f1f1f;
      padding: 1.5rem;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
      font-size: 20px;
    }

    .sidebar a {
      color: white;
      text-decoration: none;
      display: block;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .sidebar a:hover {
      color: #0d6efd;
    }

    .main-container {
      margin-left: 250px;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .page-title {
      font-size: 32px;
      font-weight: bold;
    }

    .subtitle {
      color: #ccc;
      font-size: 18px;
      margin-bottom: 2rem;
    }

    .roles-section {
      display: flex;
      flex-grow: 1;
    }

    .roles-list {
      width: 200px;
      background-color: #1a1a1a;
      padding: 1rem;
      border-radius: 8px;
      margin-right: 2rem;
    }

    .roles-list h5 {
      margin-bottom: 1rem;
    }

    .roles-list label {
      display: block;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .add-role {
      color: #ff004c;
      border: none;
      background: none;
      font-weight: bold;
      padding: 0;
      cursor: pointer;
    }

    .permissions-info {
      flex-grow: 1;
      background-color: #1a1a1a;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
    }

    .permissions-info i {
      font-size: 36px;
      margin-bottom: 1rem;
    }

    .custom-permissions {
      margin-top: auto;
      padding-top: 1.5rem;
      border-top: 1px solid #333;
    }

    .custom-permissions h5 {
      margin-bottom: 0.5rem;
    }

    .custom-permissions p {
      font-size: 14px;
      color: #ccc;
    }

    .custom-permissions button {
      margin-top: 0.5rem;
      color: #ff004c;
      border: 1px solid #ff004c;
      background: transparent;
      border-radius: 4px;
      padding: 6px 14px;
      font-size: 18px;
      cursor: pointer;
    }

    .custom-permissions button:hover {
      background-color: #ff004c;
      color: white;
    }

    .role-item {
      padding: 8px 12px;
      margin-bottom: 8px;
      background-color: #2a2a2a;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s ease;
      font-weight: normal;
    }

    .role-item:hover {
      background-color: #333;
    }

    .role-selected {
      font-weight: bold;
      background-color: #444;
    }

    .role-locked {
      color: gray;
      cursor: not-allowed;
      background-color: #1f1f1f;
    }
  </style>
</head>
<body>
  <nav class="sidebar" id="sidebar">
    <h2>Dashboard</h2>
    <a href="/">Home</a>
    <a href="/roblox.html">Roblox Lookup</a>
    <a href="/discord.html">Discord Info</a>
    <a href="/settings.html">Settings</a>
    <a href="/permissions.html">Permissions</a>
    <a href="/members.html">Members</a>
  </nav>

  <div class="main-container">
    <div class="page-title">üîç Access Control</div>
    <div class="subtitle">Configure Organization Roles & Permissions</div>

    <div class="roles-section">
      <div class="roles-list">
        <h5>Roles</h5>
        <div id="rolesContainer">
          <div class="role-item role-locked" data-role="Owner">Owner</div>
          <div class="role-item" data-role="Everyone">Everyone</div>
        </div>
        <button class="add-role" onclick="addNewRole()">ADD NEW</button>
      </div>

      <div class="permissions-info" id="permissionsInfo" style="display: none;">
        <ul class="nav nav-tabs" id="permissionTabs">
          <li class="nav-item">
            <a class="nav-link active" href="#" onclick="switchTab('general')">GENERAL</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="switchTab('permissions')">PERMISSIONS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="switchTab('ratelimits')">RATELIMITS</a>
          </li>
        </ul>

        <div id="tabContent" class="p-4">
          <!-- Tab contents will be injected dynamically -->
        </div>
      </div>
    </div>

    <div class="custom-permissions">
      <h5>Custom Permissions</h5>
      <p>Add custom permissions to roles that can be queried in-game for in-game access/feature control.</p>
      <button onclick="addCustomPermission()">+</button>
      <ul id="customPermissionsList" style="margin-top: 10px;"></ul>
    </div>
  </div>

  <script>
  const rolesContainer = document.getElementById('rolesContainer');
  const permissionsInfo = document.getElementById('permissionsInfo');
  const customPermissionsList = document.getElementById('customPermissionsList');

  const DEFAULT_ROLES = ['Owner', 'Everyone'];

  function getStoredRoles() {
    const saved = localStorage.getItem('roles');
    return saved ? JSON.parse(saved) : DEFAULT_ROLES;
  }

  function saveRoles(roles) {
    localStorage.setItem('roles', JSON.stringify(roles));
  }

  function renderRoles(selected = null) {
    rolesContainer.innerHTML = '';

    const roles = getStoredRoles();
    roles.forEach(role => {
      const roleDiv = document.createElement('div');
      roleDiv.classList.add('role-item');
      roleDiv.dataset.role = role;
      roleDiv.textContent = role;

      if (role === 'Owner') {
        roleDiv.classList.add('role-locked');
      } else if (role === selected) {
        roleDiv.classList.add('role-selected');
      }

      rolesContainer.appendChild(roleDiv);
    });
  }

  function renderPermissionsTab(role) {
    permissionsInfo.style.display = 'block';

    const tabContent = document.getElementById('tabContent');
    tabContent.innerHTML = `
      <h5>General Configuration</h5>
      <div class="mb-3">
        <label for="roleNameInput" class="form-label">Role Name</label>
        <input type="text" id="roleNameInput" class="form-control bg-dark text-white" value="${role}">
      </div>
      <div class="mb-3">
        <label class="form-label">Role Color</label><br>
        <button class="btn btn-dark border"><i class="bi bi-palette"></i></button>
      </div>
      <hr>
      <h6>Role Name</h6>
      <p class="text-muted" style="font-size: 14px;">
        The name of the role can be customized per your liking. This role name is public to any member of the organization,
        so make sure it's not anything bad. The role name will be reflected when you assign roles in the Members tab.
      </p>

      <h6>Department Name</h6>
      <p class="text-muted" style="font-size: 14px;">
        Departments are helpful when you want to restrict roles from being managed by a certain role. For example, an appeals
        department manager would not be able to manage or give out roles for the community management department.
        By default, the department with empty name: "" is the department of every role; leave a role department blank
        to have it be default. Department Names cannot have spaces or special characters.
      </p>
    `;
  }

  function switchTab(tab) {
    const tabContent = document.getElementById('tabContent');
    const navLinks = document.querySelectorAll('#permissionTabs .nav-link');
    navLinks.forEach(link => link.classList.remove('active'));

    const activeLink = [...navLinks].find(link => link.textContent === tab.toUpperCase());
    if (activeLink) activeLink.classList.add('active');

    if (tab === 'general') {
      const selected = document.querySelector('.role-selected');
      if (selected) renderPermissionsTab(selected.dataset.role);
    } else {
      tabContent.innerHTML = `<p class="text-muted">Content for ${tab.toUpperCase()} will go here.</p>`;
    }
  }

  rolesContainer.addEventListener('click', function (e) {
    const target = e.target;
    if (target.classList.contains('role-item')) {
      const role = target.dataset.role;

      if (target.classList.contains('role-locked')) {
        alert("The Owner role cannot be edited.");
        return;
      }

      document.querySelectorAll('.role-item').forEach(item =>
        item.classList.remove('role-selected')
      );

      target.classList.add('role-selected');

      // Show the tabbed permissions panel and render the general tab
      permissionsInfo.style.display = 'block';
      switchTab('general');
    }
  });

  function addNewRole() {
    let roleName = prompt("Enter new role name:");
    if (!roleName) return;

    roleName = roleName.trim();
    if (!/^[\w-]+$/.test(roleName)) {
      alert("Role name must not contain spaces or special characters.");
      return;
    }

    if (DEFAULT_ROLES.includes(roleName)) {
      alert("This role name is reserved.");
      return;
    }

    const currentRoles = getStoredRoles();
    if (currentRoles.includes(roleName)) {
      alert("Role already exists.");
      return;
    }

    currentRoles.push(roleName);
    saveRoles(currentRoles);
    renderRoles(roleName); // auto-select the new role
    switchTab('general');
  }

  function addCustomPermission() {
    const permission = prompt("Enter a custom permission:");
    if (permission) {
      const li = document.createElement('li');
      li.textContent = permission;
      li.style.fontSize = '14px';
      li.style.color = '#ccc';
      customPermissionsList.appendChild(li);
    }
  }

  // Initialize roles on page load
  renderRoles();
</script>
</body>
</html>
